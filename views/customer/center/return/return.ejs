<% include ../../header.ejs%>
<%
var paginator = data.paginator || {};
var pageSize = parseInt(paginator.ps) || 10;
var page = parseInt(paginator.p) || 1;
%>
<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">
        <!--Header Toolbar-->

        <!--Header Toolbar Close-->

        <!--Header-->
        <% include ../_nav_head.ejs%>
        <!--Header Close-->
        <div class="page double-padding-bottom">
            <div class="container page-content">
                <div class="row space-top">
                    <!-- Sidebar-->
                    <% var active = "return_customer"; %>
                    <% include ../_nav_customer_left.ejs%>
                    <!-- Sidebar CLose-->
                    <!--Catalog List-->
                    <section class="col-md-10 space-bottom page-content-right">
                        <div class="filterDiv">
                            <div class="filterHead">
                                <div>筛选：</div>
                                <div class="defaultdropdown">
                                    <div class="btn-group">
                                        <button type="button" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span>
                                                <% if(paginator.cf == "订单状态" && paginator.cv != "%") {%>
                                                <%= data._translation.ReturnStatus[paginator.cv]%>
                                                <% } else {%>
                                                全部状态
                                                <% } %>
                                            </span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <% var paginatorNull = {
                                                    url: "return",
                                                    paginator: {}
                                                }%>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorNull)%>)">全部状态</a>
                                            </li>
                                            <% for(var key in data._translation.ReturnStatus){%>
                                            <li>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    cf : "订单状态",
                                                    cv : key,
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)"><%= data._translation.ReturnStatus[key]%></a>
                                            </li>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>
                                <div class="defaultdropdown">
                                    <div class="btn-group">
                                        <button type="button" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span>
                                                <% if(paginator.sf == "申请时间" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                申请时间
                                                <% } else if(paginator.sf == "退货单号" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                退货单号
                                                <% } else if(paginator.sf == "订货单号" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                订单号
                                                <% } else if(paginator.sf == "客户名" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                客户名称
                                                <% } %>
                                            </span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li class="sortReturn_1">
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "申请时间",
                                                    sv : "DESC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">申请时间</a>
                                                <% } else if(paginator.sv=='DESC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "申请时间",
                                                    sv : "ASC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">申请时间</a>
                                                <% } %>
                                            </li>
                                            <li class="sortReturn_2">
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "退货单号",
                                                    sv : "DESC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">退货单号</a>
                                                <% } else if(paginator.sv=='DESC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "退货单号",
                                                    sv : "ASC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">退货单号</a>
                                                <% } %>
                                            </li>
                                            <li class="sortReturn_4">
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "客户名称",
                                                    sv : "DESC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">客户名称</a>
                                                <% } else if(paginator.sv=='DESC'){%>
                                                <% var paginatorData = {
                                                    url : "return?",
                                                    sf : "客户名称",
                                                    sv : "ASC",
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">客户名称</a>
                                                <% } %>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <%
                            var paginator_keywordsValue = '';
                            if (typeof paginator != 'undefined') {
                                if (typeof paginator.kv != 'undefined') {
                                    paginator_keywordsValue = (paginator.kv == "%") ? "" : paginator.kv;
                                }
                            }
                            %>
                            <% var placeholder = "请输入退货单号/订单号/客户名"%>
                            <% var paginatorData = {
                                url : "return?",
                                kv : 'keywordsValueToBeReplaced',
                                p : 1,
                                paginator : paginator
                            };
                            %>
                            <% include ../../public/filterInput.ejs%>
                            <a class=" btn btn-primary tooltipped" href="/customer/report/returns" title="导出全部退货信息" data-toggle="tooltip" data-placement="bottom"><i class="fa fa-floppy-o"></i></a>

                        </div>
                        <div class="space-top">
                            <table class="sm-page-table">
                                <thead>
                                <tr>
                                    <td style="text-align: end"><strong>退货单号</strong></td>
                                    <td><strong>订单号</strong></td>
                                    <td><strong>客户名</strong></td>
                                    <td><strong>申请时间</strong></td>
                                    <td><strong>笔数/数量/金额</strong></td>
                                    <td><strong>状态</strong></td>
                                    <td><strong>操作</strong></td>
                                </tr>
                                </thead>
                                <% if(returns.length > 0){%>
                                <% for(var i in returns) { %>
                                <form method="post">
                                    <tr style="font-size: 12px;">
                                        <td style="text-align: end">
                                            <% if((Number(returns[i].returnShippedQuantity) != Number(returns[i].receiveShippedQuantity))
                                                && (returns[i].status === 'DELIVERED')){%>
                                            <a class="tooltipped" title="该单发货数量与入库数量不一致" data-toggle="tooltip" data-placement="right" style="color: red;">
                                                <i class="fa fa-exclamation-circle"></i></a>
                                            <% } %>
                                            <a href="/customer/return/detail?returnId=<%= returns[i].id %>"><%= returns[i].displayReturnId %></a>
                                        </td>
                                        <td>
                                            <%= returns[i].displayOrderId %>
                                        </td>
                                        <td><%= returns[i].clientName %></td>
                                        <td><%= returns[i].createdOn %></td>
                                        <td>
                                            <%= returns[i].countBatch %>
                                            /
                                            <%= returns[i].quantity %>
                                            /
                                            &yen;<%= Number(returns[i].subtotal).toFixed(data.pointDigit.DEFAULT) || "金额" %>
                                        </td>
                                        <td>
                                            <%= data._translation.ReturnStatus[returns[i].status]%>
                                        </td>
                                        <td>
                                            <% if(returns[i].status=='CREATED'){ %>
                                            <a href="/customer/return/detail?returnId=<%= returns[i].id %>"><i class="fa fa-gavel tooltipped" data-toggle="tooltip" data-placement="right" title="审核"></i></a>
                                            <% }else if(returns[i].status == "SHIPPED"){ %>
                                            <a href="/customer/return/detail?returnId=<%= returns[i].id %>"><i class="fa fa-archive tooltipped" data-toggle="tooltip" data-placement="left" title="确认收货" style="margin-right: 8px"></i></a>
                                            <% } else {%>
                                            <a href="/customer/return/detail?returnId=<%= returns[i].id %>" ><i class="fa fa-binoculars tooltipped" data-toggle="tooltip" data-placement="left" title="查看" style="margin-right: 8px"></i></a>
                                            <% }%>
                                            <% if(returns[i].status=='CLOSED'||returns[i].status=='DELIVERED'){ %>
                                            <a class="tooltipped" href="javascript:;" style="color: #999999">
                                                <i class="fa fa-times-circle"></i>
                                            </a>
                                            <% } else {%>
                                            <a class="tooltipped customerCancelReturnDialog" title="取消" data-toggle="tooltip"
                                               data-displayId="<%= returns[i].displayReturnId %>"
                                               data-opId="<%= returns[i].operatorId %>"
                                               returnId="<%= returns[i].id%>"  data-placement="top">
                                                <i class="fa fa-times-circle"></i>
                                            </a>
                                            <% } %>
                                        </td>
                                    </tr>
                                </form>
                                <% } %>
                                <% } else {%>
                                <tr>
                                    <td colspan="6">
                                        <h4 class="blank-content">您目前还没有新的退货信息</h4>
                                    </td>
                                </tr>
                                <% } %>
                            </table>
                        </div>

                        <div class="space-top">
                            <% var url = "return?"%>
                            <% include ../../_paginator.ejs%>
                        </div>
                    </section>
                </div>
            </div>
        </div>
        <% include ../../_nav_bottom.ejs%>
    </div>
</div>
<% include  ../../footer.ejs %>
<script>
    $(function(){
        $('.datePicker').datetimepicker({
            timepicker: false,
            format:'Y-m-d'
        });

    });
</script>