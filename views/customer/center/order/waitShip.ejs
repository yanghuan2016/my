<% include ../../header.ejs%>

<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">
            <!--Header Toolbar-->

            <!--Header Toolbar Close-->

            <!--Header-->
            <% include ../_nav_head.ejs%>
            <!--Header Close-->

            <!--Page Content--><!-- InstanceBeginEditable name="content" -->
            <div class="page">

                <div class="container page-content">
                    <div class="row space-top">
                        <!-- hidden div-->
                        <div style="position: fixed;z-index: 1006;left: 0;top: 0;background: #000;opacity:0.5;width: 100%;height: 100%;display: none" class="fadeDiv">
                        </div>
                        <iframe style="font-size: 14px;padding: 4px;display:none;width:50%;height:940px;z-index: 1023;" id="addProductToShipIframe" src="/goods/goodsList?nextToUrl=addProductToShipOrder">
                        </iframe>
                        <div style="font-size: 14px;padding: 4px;display:none;width:700px;height:900px;z-index: 1023;" id="selectGoods" goodsid="" shippedNum="">
                            <div class="page-content space-top">
                                <section class="page-content-right">
                                    <aside class="page-content-right-head">
                                        <label>添加发货</label>
                                    </aside>
                                    <div class="form" style="padding:30px">
                                        <div class="row" style="margin-top:10px">
                                            <span class="col-sm-3">批次号:&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <input class="col-sm-9 inputBatchNum" type="text"  />
                                        </div>
                                        <div class="row" style="margin-top:20px">
                                            <span class="col-sm-3">生产日期:</span>
                                            <input class="col-sm-9  waitShipGoodsProducedDate inputGoodsProduceDate" type="text" id="productDate" />
                                        </div>
                                        <div class="row" style="margin-top:20px">
                                            <span class="col-sm-3">
                                                有效期至:
                                            </span>
                                            <input class="col-sm-9  waitShipGoodsValidDate inputGoodsValidDate" type="text"  id="quanlityDate"/>
                                        </div>
                                        <div class="row" style="margin-top:20px">
                                            <div class="col-sm-3" style="display: inline">
                                                <span style="vertical-align: middle;">数量：</span>
                                            </div>
                                            <div class="col-sm-4" style="display: inline;">
                                                <div style="display:inline-block">
                                                    <div>
                                                        <a class="incr-btn fa fa-minus-circle inactive subA" data-action="decrease" id="skumin_midnum_0" href="#"></a>
                                                        <p class="quantity" type="text" style="display: inline-flex;width: auto;margin: 0;line-height: 0;">
                                                            [<label id="midNum"></label><span id="midUnit"></span>/件]
                                                        </p>
                                                        <a class="incr-btn fa fa-plus-circle incA" data-action="increase" id="skuplus_midnum_0" href="#"></a>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-4" style="display:inline">
                                                <div style="display:inline">
                                                    <a  class="quantity_change subNumShip " type="decrease" quantity="1"  href="#"><i class="fa fa-angle-left inactive font"></i></a>
                                                    <input class="inputQuantity" type="text" data="" style="width:90px;text-align: center;">
                                                    <a class="quantity_change incNumShip" type="increase" quantity="1"   href="#"> <i class=" fa fa-angle-right font"></i></a>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row" style="margin-top:20px">
                                            <div class="col-sm-3" style="display: inline">
                                                <span style="vertical-align: top;">电子监管码：</span>
                                            </div>
                                            <textarea name="" style="height:150px;resize:none" id="" class="inputDrugESC col-sm-9"></textarea>
                                        </div>

                                        <div class="row" style="margin-top:20px">
                                            <div class="col-sm-3" style="display: inline">
                                                <span style="vertical-align: top;">质检报告(附件):</span>
                                            </div>
                                            <div class="col-sm-9" style="padding: 0">
                                                <% include ../../inportFile.ejs %>
                                            </div>
                                        </div>
                                        <div class=" pull-right">
                                            <a class="btn btn-primary" id="addShipItem">确认</a>
                                            <a class="btn btn-primary closeIframeGuide">取消</a>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <!-- hidden div close-->
                        <!-- Sidebar-->
                        <% var active = "order_customer"; %>
                        <% include ../_nav_customer_left.ejs%>
                        <!-- Sidebar CLose-->
                        <section class="col-md-10 space-bottom">
                            <div class="filterDiv">
                                <div class="filterHead">
                                    订单号：<%if(orders.length>0){%>
                                    <a href="/customer/order/pending?orderId=<%= orders[0].id%>"><%=orders[0].displayOrderId %></a>
                                    <%}%>&nbsp;-&nbsp;<%= data._translation.OrderStatus[data.orderStatus]%>
                                    <label style="display:none" id="hiddenClientId"><%= orders[0].clientId %></label>
                                </div>
                                <% if(!data.shipStrictly) { %>
                                <div>
                                    <a class="btn btn-primary" id="selectProductDialog">添加商品</a>
                                </div>
                                <% } %>
                                <input type="hidden" value="<%= data.pointDigit.DEFAULT%>" id="pointDigit"/>
                            </div>
                            <div class="space-top">
                                <table class="sm-page-table">
                                    <thead>
                                    <tr>

                                        <td class="checkbox-item"></td>
                                        <td class="goods-info"><strong>商品信息</strong></td>
                                        <td><strong>货号</strong></td>
                                        <td><strong>订单数量</strong></td>
                                        <td style="display:<%= data.orderStatus=='SHIPPED'?'table-cell':'none'%>"><strong>往次总发</strong></td>
                                        <td><strong>本次总发</strong></td>
                                        <td><strong>单价</strong></td>
                                        <td><strong>［批次］/数量</strong></td>
                                        <td><strong>小计</strong></td>
                                    </tr>
                                    </thead>
                                    <tbody class="shipTableBody">
                                    <%if(orders){%>
                                    <% for(var i in orders){%>
                                    <% var order = orders[i]%>
                                    <% console.log("****************************"+orders[i])%>
                                    <tr name="shipItem_<%= order.goodsId%>" goodsId="<%=order.goodsId%>" orderId="<%=order.id%>">
                                        <td class="checkbox-item"></td>
                                        <td class="goods-info">
                                            <div class="goods-img">
                                                <img src="<%= order.imageUrl%>"/>
                                            </div>
                                            <div class="goods-name-info">
                                                <h6><a href="/goods/detail?goodsId=<%=order.goodsId%>"><%=order.commonName%>
                                                        <%if(order.alias){%>
                                                        (<%=order.alias%>)
                                                        <%}%>
                                                    </a></h6>
                                                <h6><%=order.producer%></h6>
                                                <h6><%=order.spec%></h6>
                                            </div>
                                        </td>
                                        <td>
                                            <%=order.goodsNo%>
                                        </td>
                                        <td>
                                            <span name="quantity"><%=order.quantity%></span>
                                            <input type="hidden" class="maxShipNum_<%=order.goodsId%>" value="<%=order.quantity%>"
                                                   largePackNum="<%=order.largePackNum%>" largePackUnit="<%=order.largePackUnit%>"
                                                   middlePackNum="<%=order.middlePackNum%>" middlePackUnit="<%=order.middlePackUnit%>"
                                                    >
                                        </td>
                                        <td style="display:<%= data.orderStatus=='SHIPPED'?'table-cell':'none'%>"><%= order.shippedQuantity%></td>
                                        <td>
                                            <label class="font-orange shippedNum_<%=order.goodsId%>">0</label>
                                        </td>
                                        <td>&yen;<span class="price_single_<%= order.goodsId%>"><%= order.soldPrice.toFixed(data.pointDigit.DEFAULT)%></span></td>
                                        <td>
                                            <div class="ship-operator" id="template" style="display: none">
                                                <div>
                                                    [<span id="batchNum"></span>]/
                                                    <span id="batchShipNum"></span>
                                                    <span id="measureUnit"><%= order.measureUnit%></span>
                                                </div>
                                                <div>
                                                    <a class="modifyShipItem">
                                                        <i class="fa fa-pencil-square-o font font-set"></i>
                                                    </a>
                                                    <a class="deleteShipItem">
                                                        <i class="fa fa-trash font font-set"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div id="collapse_<%=order.goodsId%>" >
                                                <a class="customerAddShipItemBatchInfo" goodsId="<%=order.goodsId%>">
                                                    <i class="fa fa-plus-square font" style="color: #237935;"></i>
                                                    添加批次信息
                                                </a>
                                            </div>
                                        </td>
                                        <td>&yen;<span class="price_sum_<%= order.goodsId%>">0.00</span></td>
                                    </tr>
                                    <%}%>
                                    <%}%>
                                    <tr name="ItemTemplate" goodsId="" orderId="" style="display: none">
                                        <td class="checkbox-item">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="chkGoods" name="">
                                                </label>
                                            </div>
                                        </td>
                                        <td class="goods-info">
                                            <div class="goods-img">
                                                <img src=""/>
                                            </div>
                                            <div class="goods-name-info">
                                                <h6 name="commonName"></h6>
                                                <h6 name="birthPlace"></h6>
                                                <h6 name="spec"></h6>
                                            </div>
                                        </td>
                                        <td name="goodsNo"></td>
                                        <td>
                                            <span name="quantity"></span>
                                            <input type="hidden" class="" value=""
                                                   largePackNum="" largePackUnit=""
                                                   middlePackNum="" middlePackUnit=""
                                                    >
                                        </td>
                                        <td name="shippedNum">
                                            <label class="shippedNum" style="color: rgb(255, 87, 34);"></label>
                                        </td>
                                        <td>
                                            <div class="ship-operator" id="template" style="display: none">
                                                <div>
                                                    [<span id="batchNum"></span>]/
                                                    <span id="batchShipNum"></span>
                                                </div>
                                                <div>
                                                    <a class="modifyShipItem">
                                                        <i class="fa fa-pencil-square-o font"></i>
                                                    </a>
                                                    <a class="deleteShipItem">
                                                        <i class="fa fa-trash font"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div id="collapse" >
                                                <a class="customerAddShipItemBatchInfo" goodsId="">
                                                    <i class="fa fa-plus-square font" style="color: #237935;"></i>
                                                    添加批次信息
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="<%= data.orderStatus=='FINISHED'?9:9%>" class="goods-info">
                                            <div class="pull-left">【支付方式】<%= data._translation.StatementMonthDetailPaymentType[orders[0].paymentType]%></div>
                                            <div class="customer-ship-pricesum pull-right">
                                                <span>合计 </span>
                                                <span class="font-color-red font-weight-bold font-size-md">&yen;&nbsp;<span  id="shipSumPrice" >0.00</span></span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="<%= data.orderStatus=='FINISHED'?9:9%>" class="goods-info">
                                            <div>【发票信息】
                                                <%if(true==orders[0].hasReceipt){%>
                                                发票抬头 : <span><%= orders[0].receiptTitle%></span>
                                                <% } else{%>
                                                不需要发票
                                                <% } %>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="<%= data.orderStatus=='FINISHED'?9:9%>" class="goods-info">
                                            <div>【订单备注】 &nbsp;<span><%= orders[0].remark ? orders[0].remark : "无" %></span></div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="space-top">
                                <table class="sm-page-table">
                                    <thead>
                                    <tr>
                                        <td class="goods-info"><strong>发货信息</strong></td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="goods-info">［物流公司］
                                            <input class="inputLogisticsCompany" style="line-height: 30px;width:50%"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="goods-info">［物流单号］
                                            <input class="inputLogisticsNo" style="line-height: 30px;width:50%"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="goods-info">［发货备注］
                                            <input id="shipRemark" style="line-height: 30px;width:50%" placeholder="添加备注"/>
                                            <span style="color: red;">
                                                *如发货数量与订货数不同,请备注原因
                                            </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="space-top pull-right">
                                <button class="btn btn-primary customerShipOrder" data-displayId="<%=orders[0].displayOrderId %>">确认发货</button>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <!--Page Content Close-->
    </div><!--Layout Close-->
    <% include ../../_nav_bottom.ejs%>
</div>

<% include ../../footer.ejs %>
<script type="text/javascript" src="/static/source/js/customer/ship.js"></script>
<script type="text/javascript">
    // 选择商品
    $(document).delegate(".chkGoods", "click", function(){
        var self = $(this).closest(".icheckbox");
        if(self.hasClass("checked")){
            self.removeClass("checked");
        }else{
            self.addClass("checked");
        }
    })
</script>