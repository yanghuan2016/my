<% include ../../header.ejs%>
<%
var paginator = data.paginator || {};
var pageSize = parseInt(paginator.ps) || 10;
var page = parseInt(paginator.p) || 1;
%>

<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">

            <!--Header-->
            <% include ../_nav_head.ejs%>
            <!--Header Close-->

            <!--Page Content--><!-- InstanceBeginEditable name="content" -->
            <div class="page double-padding-bottom">

                <div class="container page-content">
                    <div class="row space-top">

                        <!-- Sidebar-->
                        <% var active = "order_customer"; %>
                        <% include ../_nav_customer_left.ejs%>
                        <!-- Sidebar CLose-->

                        <!--Catalog List-->

                        <section class="col-md-10 space-bottom">
                            <div class="filterDiv">
                                <div class="filterHead">
                                    <div>筛选：</div>
                                    <div class="defaultdropdown">
                                        <div class="btn-group">
                                            <button type="button" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span data="<%=paginator.cv%>">
                                                <% if(paginator.cv != "%") {%>
                                                    <%= data._translation.OrderStatus[paginator.cv] %>
                                                <% } else {%>
                                                全部状态
                                                <% } %></span>
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <% var paginatorNull = {
                                                        url: "order",
                                                        paginator: {}
                                                    }%>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorNull)%>)">全部状态</a>
                                                </li>
                                                <% for(var key in data._translation.OrderStatus){%>
                                                <li>
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        cf : "diliveryStatus",
                                                        cv : key,
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)"><%= data._translation.OrderStatus[key]%></a>
                                                </li>
                                                <% } %>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="defaultdropdown">
                                        <div class="btn-group">
                                            <button type="button" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span>
                                                <% if(paginator.sf == "下单时间" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                下单时间
                                                <% }else if(paginator.sf == "订货单号" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                订单号
                                                <% } else if(paginator.sf == "客户名称" && (paginator.sv == "ASC" || paginator.sv == "DESC")){%>
                                                客户名称
                                                <% } else {%>
                                                下单时间
                                                <% } %></span>
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <li class="sort-item_0">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "下单时间",
                                                        sv : "DESC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">下单时间</a>
                                                </li>
                                                <% } else if(paginator.sv=='DESC') {%>
                                                <li class="sort-item_1">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "下单时间",
                                                        sv : "ASC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">下单时间</a>
                                                </li>
                                                <% } %>
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <li class="sort-item_2">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "订货单号",
                                                        sv : "DESC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">订单号</a>
                                                </li>
                                                <% } else if(paginator.sv=='DESC') {%>
                                                <li class="sort-item_2">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "订货单号",
                                                        sv : "ASC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">订单号</a>
                                                </li>
                                                <% } %>
                                                <% if(paginator.sv=='' || paginator.sv=='ASC'){%>
                                                <li class="sort-item_3">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "客户名称",
                                                        sv : "DESC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">客户名称</a>
                                                </li>
                                                <% } else if(paginator.sv=='DESC') {%>
                                                <li class="sort-item_3">
                                                    <% var paginatorData = {
                                                        url : "order?",
                                                        sf : "客户名称",
                                                        sv : "ASC",
                                                        p : 1,
                                                        paginator : paginator
                                                    };
                                                    %>
                                                    <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">客户名称</a>
                                                </li>
                                                <% } %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <%
                                var paginator_keywordsValue = '';
                                if (typeof paginator != 'undefined') {
                                    if (typeof paginator.kv != 'undefined') {
                                        paginator_keywordsValue = (paginator.kv == "%") ? "" : paginator.kv;
                                    }
                                }
                                %>
                                <% var placeholder = "请输入订单号/客户名"%>
                                <% var paginatorData = {
                                    url : "order?",
                                    kv : 'keywordsValueToBeReplaced',
                                    p : 1,
                                    paginator : paginator
                                };
                                %>
                                <% include ../../public/filterInput.ejs%>
                                <a class=" btn btn-primary tooltipped" href="/customer/report/orders" title="导出全部订单信息" data-toggle="tooltip" data-placement="bottom"><i class="fa fa-floppy-o"></i></a>
                            </div>
                            <div class="space-top">
                                <table class="sm-page-table">
                                    <thead>
                                    <tr>
                                        <td><strong>订单号</strong></td>
                                        <td><strong>下单时间</strong></td>
                                        <td><strong>客户名</strong></td>
                                        <td><strong>金额</strong></td>
                                        <td style="display:none"><strong>支付状态</strong></td>
                                        <td><strong>订单状态</strong></td>
                                        <td class="text-end"><strong>操作</strong></td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <% if(orders.length > 0){%>
                                    <% for(var i in orders) {%>
                                    <% var item = orders[i] %>
                                    <tr>
                                        <td><a href="/customer/order/pending?orderId=<%=item.id%>"> <%= item.displayOrderId %></a></td>
                                        <td><%= item.orderTime %></td>
                                        <td><%= item.clientName?item.clientName:"" %></td>
                                        <td>&yen;<%= item.total.toFixed(data.pointDigit.DEFAULT) %></td>

                                        <td style="display:none">
                                            <%if(item.paymentStatus=="PAID"){%>
                                            已支付
                                            <%}else{%>
                                            待支付
                                            <%}%>
                                        </td>
                                        <td>
                                            <%= data._translation.OrderStatus[item.status]%>
                                        </td>
                                        <td class="fa-icon text-end" data="<%= item.status%>">
                                            <a href="/customer/order/pending?orderId=<%= item.id %>" class="tooltipped"
                                               title="查看" data-toggle="tooltip" data-placement="left"><i
                                                        class="fa fa-binoculars"></i></a>
                                            <% if (item.status == "UNPAID"){ %>
                                            <a class="tooltipped clientCancelDialog" title="关闭" orderId="<%= item.id %>"
                                               data-clientId="<%= item.clientId %>"
                                               data-displayId="<%= item.displayOrderId %>"
                                               data-toggle="tooltip" data-placement="left">
                                                <i class="fa fa-ban"></i>
                                            </a>
                                            <% } else if(item.status == "PAID") { %>
                                            <a class="tooltipped clientCancelDialog" title="关闭" orderId="<%= item.id %>"
                                               data-clientId="<%= item.clientId %>"
                                               data-displayId="<%= item.displayOrderId %>"
                                               data-toggle="tooltip" data-placement="left">
                                                <i class="fa fa-ban"></i>
                                            </a>
                                            <% } else if(item.status == "APPROVED") { %>
                                            <a href="/customer/order/waitship?orderId=<%= item.id %>" class="tooltipped"
                                               title="发货" data-toggle="tooltip" data-placement="left">
                                                <i class="fa fa-send"></i>
                                            </a>
                                            <a class="tooltipped clientCancelDialog" title="关闭" orderId="<%= item.id %>"
                                               data-clientId="<%= item.clientId %>"
                                               data-displayId="<%= item.displayOrderId %>"
                                               data-toggle="tooltip" data-placement="left">
                                                <i class="fa fa-ban"></i>
                                            </a>
                                            <% } else if(item.status == "SHIPPED" || item.status == "FINISHED") { %>
                                            <a href="/customer/order/waitship?orderId=<%= item.id %>" class="tooltipped"
                                               title="发货" data-toggle="tooltip" data-placement="left">
                                                <i class="fa fa-send"></i>
                                            </a>
                                            <% } %>
                                        </td>
                                    </tr>
                                    <% } %>
                                    <% } else {%>
                                    <tr>
                                        <td colspan="7">
                                            <h4 class="blank-content">您目前还没有新的订单信息</h4>
                                        </td>
                                    </tr>
                                    <% } %>
                                    </tbody>
                                </table>
                            </div>
                            <div class="space-top">
                                <% var url = "order?"%>
                                <% include ../../_paginator.ejs%>
                            </div>
                        </section>
                </div>
            </div>
            <!--Page Content Close-->
        </div><!--Layout Close-->
    <% include ../../_nav_bottom.ejs%>
    </div>
</div>

<% include ../../footer.ejs %>