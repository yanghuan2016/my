<% include ../header.ejs %>
<!--Off-Canvas-->
<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">
        <!--If you add class "boxed" to .site-layout it wraps the whole document in a box, than you can simply add pattern background to body or leave it white. Please note in a "boxed" mode header doesn't stick to the top.-->
        <% include  ../_nav_top.ejs %>
        <%  include  ../_nav_head.ejs  %>
        <!--Page Content--><!-- InstanceBeginEditable name="content" -->
        <div class="page" style="margin-bottom: 60px;">
            <% if(data.cart.cartItems.length > 0){%>
            <div class="container space-top page-content">
                <div class="row">
                    <!--Catalog List-->
                    <section class="col-md-12">
                        <section class="container page-content-right cart-table">
                            <section class="col-sm-12">
                                <table id="CartDetailTable" class="sm-page-table">
                                    <thead>
                                    <tr>
                                        <td class="checkbox-item" style="display: none">></td>
                                        <td class="goods-info"><strong>商品信息</strong></td>
                                        <td><strong>单价/库存</strong></td>
                                        <td><strong>批发包装</strong></td>
                                        <td><strong>购买数量</strong></td>
                                        <td>小计</td>
                                        <td>备注</td>
                                        <td>操作</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <% if(data.cart){%>
                                    <% var cartItems = data.cart.cartItems %>
                                    <% for(var i = 0;i < cartItems.length;i++){ %>
                                    <% var item =cartItems[i] ;%>
                                    <tr  class="cartItem" id = '<%= item.id %>' goodsId= '<%= item.goodsId %>' >
                                       <td class="defined-checkbox" style="display: none">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="chkGoods" name="checkbox_<%=i%>"
                                                           checked>
                                                </label>
                                            </div>
                                        </td>
                                        <td class="goods-info">
                                            <div class="goods-img">
                                                <img src="<%= item.imageUrl%>"/>
                                            </div>
                                            <div class="goods-name-info">
                                                <h6><a href="/goods/detail?goodsId=<%= item.goodsId %>"><%=item.commonName%></a></h6>
                                                <h6><%=item.producer%></h6>
                                                <h6><%= item.spec%></h6>
                                                <div class="goods-name-box">
                                                    <%if(item.isNationalMedicine == "1"){%>
                                                        <div class="base-medical-sign" title="国家基本药品">基</div>
                                                    <% } else {%>
                                                    <% } %>

                                                    <%if(item.isMedicalInsuranceDrugs == "1"){%>
                                                        <div class="medical-sign" title="医保药品">医</div>
                                                    <% } else {%>
                                                    <% } %>

                                                    <%if(item.isPrescriptionDrugs == "1"){%>
                                                        <div class="prescriptions-sign" title="处方药品">处</div>
                                                    <% } else {%>
                                                    <% } %>

                                                    <% if (item.isSplit=="1") { %>
                                                        <div class="dismantle-sign" title="可拆零">拆</div>
                                                    <% } else {%>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-mcolor">
                                            &yen; <label id="price_<%=i%>">
                                                <%= Number(item.clientGoodsPrice).toFixed(data.pointDigit.DEFAULT) %>
                                            </label>
                                            <h6 class="goods_storage">库存：<%= item.content %></h6>
                                        </td>
                                        <td>
                                            <%= item.middlePackNum %><%= item.measureUnit %> / 件
                                        </td>
                                        <td>
                                            <div class="goods-number">
                                                <div class="qnt-count qnt-count-res">
                                                    <% var defaultNum = item.isSplit == 1 ? 1 : item.middlePackNum %>
                                                    <div class="box-left">
                                                        <input id="cartChangeQuantity_<%= i %>" defaultNum="<%= defaultNum%>" goodsId="<%= item.id %>" data='{"origin":"<%= item.quantity %>"}'  isSplit = "<%=item.isSplit %>" storage="<%= (item.negSell == 1)?"-1":item.storage %>" hasSubtotal="true" type="text" value="<%= item.quantity %>">
                                                    </div>
                                                    <div class="box-right">
                                                        <div>
                                                            <a class="fa fa-plus" pack="1" defaultNum="<%= defaultNum%>" isSplit=<%= item.isSplit%>  type="increase" id="cartQuantityChange_<%=i%>"></a>
                                                        </div>
                                                        <div>
                                                            <a class="fa fa-minus" pack="1" defaultNum="<%= defaultNum%>" isSplit=<%= item.isSplit%> type="decrease" id="cartQuantityChange_<%=i%>"></a>
                                                        </div>
                                                    </div>
                                                    <div class="box-tips">
                                                    <% if(item.cartFavorName){%>
                                                    <h5 class="text-info" style="text-align: left;padding-left: 0px;">
                                                        <a href="/portal/purchaseList/edit?type=look&listId=<%=item.cartFavorId%>">常购清单:<%=item.cartFavorName%></a></h5>
                                                    <%}%>
                                                    </div>
                                                </div>
                                            </div>
                                        <td class="text-mcolor">
                                            &yen;<label id="subtotal_<%=i%>">
                                                <%= (item.clientGoodsPrice * item.quantity).toFixed(data.pointDigit.DEFAULT) %>
                                            </label>
                                        </td>
                                        <td>
                                            <input type="text" style="width: 150px;display: inline-block;zoom: 1" class="form-control" id="remark_<%= i %>" placeholder="添加备注" value="<%= item.remarks %>">
                                        </td>
                                        <td>
                                            <a  class="text-primary tooltipped" id="remove_<%= i %>" goodsId="<%= item.goodsId %>"  title="删除" data-toggle="tooltip" data-placement="bottom"><strong><i class="fa fa-trash"></i> </strong></a>
                                        </td>
                                    </tr>
                                    <% } %>
                                    <% } %>
                                    </tbody>
                                </table>
                            </section>
                        </section>
                        <div class="container space-top space-border">
                            <div class="pull-left" style="margin-left: 15px;">
                                <button type="button" class="btn-outlined btn-sm btn-default2 removeAll">清空购物车</button>
                                <button type="button" class="btn-outlined btn-sm  chkAll checked" style="display: none">>全选</button>
                                <button type="button" class="btn-outlined btn-sm btn-default2 removeSelected" style="display: none">>删除选中商品</button>
                            </div>
                           <%if(data.clientContractInfo.paymentType=="CREDIT"){%>
                            <div class="pull-right">
                                <h4 class="text-primary paimary-space">
                                    <% if (data.clientFinance.credits != null && data.clientFinance.credits != '') { %>
                                    <span>授信额度： &yen; </span><%= data.clientFinance.credits %>
                                    <% } %>
                                    <% if (data.clientFinance.arrearsBalance != null && data.clientFinance.arrearsBalance != '') { %>
                                    <span>可用余额： &yen; </span><%= data.clientFinance.arrearsBalance %>
                                    <% } %>
                                    <% if (data.clientFinance.accountDays != null && data.clientFinance.accountDays != '') { %>
                                    <span>结款日期： </span>每月<%= data.clientFinance.accoutDays %>日
                                    <% } %>
                                </h4>
                            </div>
                            <%}%>
                        </div>
                        <div class="cart-total-display">
                            <div class="space-right-top">
                                <span>商品总额： </span><span>&yen; <strong id="total"><%= data.cart.total.toFixed(2) %></strong>元</span>
                            </div>
                            <div class="cart-total-display-address"  style="display:<%= data.shipToRegisteredAddressOnly!=true?'none':'block' %>">
                                <label>收货地址:</label>
                                <span id="address-user"><%= data.defaultAddress %></span>
                            </div>
                            <div class="cart-total-display-address">
                                <label>发票信息:</label>
                                <div class="checkbox cart-checkbox-total" attr-display="true">
                                    <label>
                                        <input type="checkbox" id="chkTikles">
                                    </label>
                                </div>
                                <span>我要发票</span>
                                <div class="tikles">
                                    <span>发票抬头:&nbsp;<span id="tikelsContent"><%= data._userInfo.clientName%></span></span>
                                </div>
                            </div>
                            <div class="cart-total-display-address">
                                <label>订单备注:</label>
                                <input class="form-control" name="content" id="cart_remarks" placeholder="添加备注信息" value='<%= data.cart.remarks %>' />
                            </div>
                        </div>

                        <!--<section class="container page-content-right space-top">
                            <section class="col-sm-12">
                              <!--  <table class="address-table table cartAddressTable">
                                    <thead>
                                    <tr>
                                        <td class="address-info form-header">收货地址</td>
                                        <td></td>
                                        <td class="address-info" style="float: right;">
                                            <button type="button" class="showNewAddressItem btn-cart" style="color:#237935;padding-left: 10%;padding-right: 10%;">新增收货地址</button>
                                        </td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <% var index = 0; %>
                                    <% for(var i in data.address) { %>
                                    <% index++; %>
                                    <% var item = data.address[i] %>


                                    <tr class="address-list" style="display:<%=i>=2?'none':'table-row'%>" >
                                        <td class="address-info" colspan="2">
                                            <label class="flag">
                                                <a >
                                                    <% if(data.address.length==1 || index==1){ %>
                                                    <i class="fa fa-check-circle fa-lg"></i>
                                                    <% }else { %>
                                                    <i class="fa  fa-circle-o"></i>
                                                    <% } %>
                                                </a>
                                            </label>
                                            <span class="address-name"><%= item.detailAddress %></span>
                                        </td>
                                        <td class="address-info address-operate">
                                            <label class="modAddress change-address" id="item_<%=item.id%>">
                                                <a style="" class="tooltipped" title="修改" data-toggle="tooltip" data-placement="left">
                                                    <i class="fa fa-pencil-square-o"></i>
                                                </a>
                                            </label>
                                            <label class="delAddress change-address">
                                                <a class="tooltipped" title="删除" data-toggle="tooltip" data-placement="top">
                                                    <i class="fa fa-trash" id="delAM_<%=item.id%>" onclick="deleteAddress(this.id)"></i>
                                                </a>
                                            </label>
                                        </td>
                                    </tr>
                                    <% } %>


                                    <tr class="newAddressTemplate">
                                        <td colspan="2" class="address-info">
                                            <label class="flag">
                                                <a>
                                                    <i class="fa fa-lg fa-check-circle"></i>
                                                </a>
                                            </label>
                                            <span class="spanNewAddress address-name"></span>
                                        </td>
                                        <td class="address-info address-operate">
                                            <label class="modAddress change-address" id="0">
                                                <a class="tooltipped" title="修改" data-toggle="tooltip" data-placement="left">
                                                    <i class="fa fa-pencil-square-o"></i>
                                                </a>
                                            </label>
                                            <label class="delAddress change-address">
                                                <a class="tooltipped" title="删除" data-toggle="tooltip" data-placement="right">
                                                    <i class="fa fa-trash" id="0" onclick="deleteAddress(this.id)"></i>
                                                </a>
                                            </label>
                                        </td>
                                    </tr>
                                    <tr class="trModifyAddress">
                                        <td colspan="2">
                                            <input type="text" class="form-control inputAddress" placeholder="请输入收货人 + 地址 + 电话">
                                        </td>
                                        <td class="address-operate">
                                            <a class="btn btn-primary btn-outlined btnSaveAddress" onclick="updateAddress(this.id)">确认</a>
                                        </td>
                                    </tr>
                                    <tr class="trNewAddress"  >
                                        <td colspan="2">
                                            <input type="text" class="form-control inputAddress"  id="input_address" placeholder="请输入收货人 + 地址 + 电话">
                                        </td>
                                        <td class="address-operate">
                                            <a class="btn btn-primary btn-outlined btnAddAddress">添加</a>
                                        </td>
                                    </tr>
                                    <tr id="addressTips" style="display:<%= data.address.length<=2?'none':'table-row' %>">
                                        <td class="moreAddress" >
                                            <div class="addressDisplayBtn" data-display="hide">
                                                <span class="text-primary">更多地址</span><a class="fa fa-long-arrow-down"></a>
                                            </div>

                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>-->
                                <table class="address-table table cartAddressTable clear-border-top" style="display:<%= data.shipToRegisteredAddressOnly==true?'none':'' %>;margin-top:20px;" >
                                    <thead class="clear-border-top">
                                    <tr>
                                    <td class="address-info form-header clear-border-top">收货地址</td>
                                    <td class="clear-border-top"></td>
                                    <% if(data.shipToRegisteredAddressOnly!=true){%>
                                    <td class="address-info clear-border-top" style="float: right;">
                                        <button type="button" class="btn-outlined btn-default2 showNewAddressItem btn-color" style="color:#237935;padding-left: 10%;padding-right: 10%;">新增收货地址</button>
                                    </td>
                                    <%}else{%>
                                    <td class="clear-border-top"></td>
                                    <%}%>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    <!--默认的收货地址-->


                                    <tr class="address-list" >
                                        <td class="address-info" colspan="2">
                                            <label class="flag">
                                                <a>
                                                    <i class="fa fa-check-circle fa-lg"></i>
                                                </a>
                                            </label>
                                            <span class="address-name"><%= data.defaultAddress %></span>
                                        </td>
                                        <td class="address-info address-operate">

                                        </td>
                                    </tr>


                                    <% if(data.shipToRegisteredAddressOnly!=true){%>

                                    <% var index = 0; %>
                                    <% for(var i in data.address) { %>
                                    <% index++; %>
                                    <%
                                        var item = data.address[i];

                                    %>


                                    <tr class="address-list" style="display:<%= i>0?'none':'table-row'%>" >
                                        <td class="address-info" colspan="2">
                                            <label class="flag">
                                                <a >

                                                    <i class="fa  fa-circle-o"></i>

                                                </a>
                                            </label>
                                            <span class="address-name"><%= item.detailAddress %></span>
                                        </td>
                                        <td class="address-info address-operate">
                                            <label class="modAddress change-address" id="item_<%=item.id%>">
                                                <a style="" class="tooltipped" title="修改" data-toggle="tooltip" data-placement="left">
                                                    <i class="fa fa-pencil-square-o"></i>
                                                </a>
                                            </label>
                                            <label class="delAddress change-address">
                                                <a class="tooltipped" title="删除" data-toggle="tooltip" data-placement="top">
                                                    <i class="fa fa-trash" id="delAM_<%=item.id%>" onclick="deleteAddress(this.id)"></i>
                                                </a>
                                            </label>
                                        </td>
                                    </tr>
                                    <% } %>


                                    <tr class="newAddressTemplate">
                                        <td colspan="2" class="address-info">
                                            <label class="flag">
                                                <a>
                                                    <i class="fa fa-lg fa-check-circle"></i>
                                                </a>
                                            </label>
                                            <span class="spanNewAddress address-name"></span>
                                        </td>
                                        <td class="address-info address-operate">
                                            <label class="modAddress change-address" id="0">
                                                <a class="tooltipped" title="修改" data-toggle="tooltip" data-placement="left">
                                                    <i class="fa fa-pencil-square-o"></i>
                                                </a>
                                            </label>
                                            <label class="delAddress change-address">
                                                <a class="tooltipped" title="删除" data-toggle="tooltip" data-placement="right">
                                                    <i class="fa fa-trash" id="0" onclick="deleteAddress(this.id)"></i>
                                                </a>
                                            </label>
                                        </td>
                                    </tr>
                                    <tr class="trModifyAddress">
                                        <td colspan="2">
                                            <input type="text" class="form-control inputAddress" placeholder="请输入收货人 + 地址 + 电话">
                                        </td>
                                        <td class="address-operate">
                                            <a class="btn btn-primary btn-outlined btnSaveAddress" onclick="updateAddress(this.id)">确认</a>
                                        </td>
                                    </tr>
                                    <tr class="trNewAddress"  >
                                        <td colspan="2">
                                            <input type="text" class="form-control inputAddress"  id="input_address" placeholder="请输入收货人 + 地址 + 电话">
                                        </td>
                                        <td class="address-operate">
                                            <a class="btn btn-primary btn-outlined btnAddAddress">添加</a>
                                        </td>
                                    </tr>
                                    <tr id="addressTips" style="display:<%= data.address.length<2?'none':'table-row' %>">
                                        <td class="moreAddress" >
                                            <div class="addressDisplayBtn" data-display="hide">
                                                <span class="text-primary">更多地址</span><a class="fa fa-long-arrow-down"></a>
                                            </div>

                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <%}%>


                                </table>
                    </section>
                    <div class="pull-right space-top space-bottom">
                        <% var rejectStatus=(data._client&&(data._client.registerStatus=="REJECTED"||data._client.registerStatus=="CREATED"||data._client.registerStatus=="UPDATED"))%>
                        <button type="button" href="javascript:void(0)" data-client="<%=data._client.id %>"  <%=rejectStatus?"disabled  style=background-color:grey;border-color:grey":"" %>  data-expire="<%= isexpire%>"  data-clientType="<%=data.clientContractInfo.paymentType  %>"   class="btn-primary btn-md submitOrder">确认订单</button>

                    </div>
                </div>
            </div>
            <%} else {%>
            <section class="container space-top page-content">
                <div class="notFound">
                    <h4><%= tip%></h4>
                </div>
                <div class="notFound">
                    <h4>去
                        <a href="/">首页</a>
                        逛逛吧</h4>
                </div>
            </section>
            <% } %>
        </div>
        <!--Page Content Close-->
    </div> <!--Layout Close-->
    <% include ../_nav_bottom.ejs %>

    <% include ../purchaseDeal.ejs%>
</div><!--Off-Canvas Close-->
<!--scc-src js-->
<script src="/static/source/js/address.js"></script>
<% include ../footer.ejs %>
<script src="/static/js/jq-signature.min.js"></script>
<script src="/static/source/js/page/cart.js"></script>