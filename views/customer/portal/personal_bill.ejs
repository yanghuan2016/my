<% include ../header.ejs%>
<%
var paginator = data.paginator || {};
var pageSize = parseInt(paginator.ps) || 10;
var page = parseInt(paginator.p) || 1;
%>
<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">
        <!--Header Toolbar-->
        <% include ../_nav_top.ejs %>
        <!--Header Toolbar Close-->

        <!--Header-->
        <% include ../_nav_head.ejs%>
        <div class="page double-padding-bottom" style="min-height:801px">
            <!--Breadcrumbs-->
            <div class="container page-nav">
                <ol class="breadcrumb">
                    <li><a href="/" class="click-link">主页</a></li>
                    <i class="fa fa-angle-right"></i>
                    <li><a href="#" class="active">结款订单</a></li>
                </ol>
            </div><!--Breadcrumbs Close-->
            <div class="container page-content">
                <div class="row" >

                    <section class="col-md-10 pull-right space-top space-bottom page-content-right">


                        <aside class="page-content-right-head"  >
                            <label>时段选择:</label>
                            <div style="height: 50px;">
                                <i class="fa fa-calendar"></i>
                                <input style="vertical-align:middle"  value="<%=data.pageData.beginDate   %>"   id="startDate" type="text" readonly class="cDatePicker selectTime"/>
                                －
                                <i class="fa fa-calendar"></i>
                                <input style="vertical-align:middle"   value="<%=data.pageData.endDate   %>" id="endDate" type="text"  readonly class="cDatePicker selectTime"/>
                            </div>
                            <a class="btn btn-primary searchBill" >查询</a>
                        </aside>
                        <div class="col-sm-12">
                            <table class="table page-table">
                                <thead>
                                <tr>
                                    <td><strong>日期</strong></td>
                                    <td><strong>出库金额</strong></td>
                                    <td><strong>冲红金额</strong></td>
                                    <td><strong>结款金额</strong></td>
                                </tr>
                                </thead>
                                <tbody>


                                <% var billList = data.billList; %>
                                <% var blLength=billList.length; %>
                                <% var totalAmount=0; %>
                                <% for (var i = 0; i < blLength;i++){%>
                                <% var curBill=billList[i];
                                    totalAmount+=curBill.netIncome;
                                %>

                                <tr>
                                    <td><%= curBill.clearingDate %></td>
                                    <td><span>&yen;</span><%= curBill.income.toFixed(2) %></td>
                                    <td><span>&yen;</span><%= curBill.refund.toFixed(2) %></td>
                                    <td><span>&yen;</span><%= curBill.netIncome.toFixed(2) %></td>
                                </tr>

                                <% if(i==blLength-1){ %>
                                <tr style="font-weight:bold">
                                    <td colspan="2"></td>
                                    <td >
                                        合计:
                                    </td>
                                    <td>
                                        <span>&yen;</span>
                                        <%= totalAmount.toFixed(2) %>
                                    </td>
                                </tr>
                                <%}%>

                                <%}%>
                                </tbody>
                            </table>
                        </div>

                    </section>

                    <!-- Sidebar-->
                    <% include ../_order_sidebar.ejs%>
                    <!-- Sidebar CLose-->

                </div>
            </div>
        </div>
    </div>
    <% include ../_nav_bottom.ejs%>
</div>
<% include  ../footer.ejs %>
<script type="text/javascript">
    $(function(){
        $('.cDatePicker').datetimepicker({
            timepicker: false,
            format:'Y-m-d',
            minDate:false
        });

        $(document).delegate('.searchBill','click',function(){
            var startDate=$('#startDate').val();
            var endDate=$('#endDate').val();
            if(new Date(startDate)>new Date(endDate)){
                artDialogAlertModal('截止日期不能早于起始日期,请确认');
                return;
            }
            window.location.href="/portal/personal/bill?"+"beginDate="+startDate+"&endDate="+endDate;
            return;
        });

    });


</script>