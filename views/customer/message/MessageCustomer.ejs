<% include ../header.ejs %>
<%
var paginator = data.paginator || {};
var pageSize = parseInt(paginator.ps) || 10;
var page = parseInt(paginator.p) || 1;
%>

<div style="position:relative;width:100%;height:100%;">
    <!--Layout-->
    <div class="site-layout">
        <!--If you add class "boxed" to .site-layout it wraps the whole document in a box, than you can simply add pattern background to body or leave it white. Please note in a "boxed" mode header doesn't stick to the top.-->
        <!--Header Toolbar-->
        <% include ../_nav_top.ejs %>
        <!--Header Toolbar Close-->
        <% include ../_nav_head.ejs %>
        <!--Page Content--><!-- InstanceBeginEditable name="content" -->
        <div class="page">

            <div class="container">
                <div class="row">

                    <!--Sidebar-->
                    <!--<% var active = "messages"; %>-->
                    <% include ../_order_sidebar.ejs %>
                    <!--Sidebar Close-->

                    <section class="col-md-10 space-top space-bottom">
                        <div class="filterDiv" style="float: right">
                            <div class="filterHead" style="margin-left: 400px">
                                <div class="defaultdropdown" style="margin: 0px 0px 10px 0px;">
                                    <div class="btn-group"  style="margin-left: 50px">
                                        <% var msgTypesName = {
                                            /* 用户应当只有部分类型，暂时有全部类型 */
                                            "DOC_ORDER": "订单信息",   /* 订单相关的通知 */
                                            "DOC_SHIP": "发货信息",    /* 发货单相关通知 */
                                            "DOC_RETURN": "退货信息",  /* 退货相关通知 */
                                            "DOC_REFUND": "退款信息",  /* 退款相关通知 */
                                            "DOC_COMPLAIN": "投诉建议",/* 投诉建议相关通知 */
                                            "DOC_ACCOUNT": "证照客户资料", /* 证照客户资料相关通知 */
                                            "DOC_PRICE": "调价单信息",   /* 调价单相关通知 */
                                            "DOC_OTHER": "其他客户通知"    /* 其他客户通知 */
                                        } %>

                                        <button type="button" style="width: 150px" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span><%= (paginator && paginator.cav != '%')?msgTypesName[paginator.cav]: "全部类型"%></span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li >
                                                <% var paginatorNull = {
                                                    url: "message",
                                                    paginator: {}
                                                }%>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorNull)%>)">全部类型</a>
                                            </li>
                                            <% for(var key in msgTypesName){ %>
                                            <li>
                                                <% var paginatorData = {
                                                    url : "message?",
                                                    caf : "docType",
                                                    cav: key,
                                                    p : 1,
                                                    paginator : paginator
                                                };
                                                %>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorData)%>)">
                                                    <%= msgTypesName[key] %></a>
                                            </li>
                                            <% } %>
                                        </ul>
                                    </div>
                                    <div class="btn-group" style="margin-left: 30px;">
                                        <button type="button" style="width: 150px" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <% var statusMapName = {
                                                "READ": "已读",   /* 订单相关的通知 */
                                                "UNREAD": "未读"    /* 发货单相关通知 */
                                            } %>
                                            <span><%= (paginator && paginator.cbv != '%')? statusMapName[paginator.cbv]: "全部状态"%></span>
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li >
                                                <% var paginatorNull = {
                                                    url: "message",
                                                    paginator: {}
                                                }%>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify(paginatorNull)%>)">全部状态</a>
                                            </li>
                                            <li>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify({
                                                    url : "message?",
                                                    cbf : "status",
                                                    cbv : 'READ',
                                                    p : 1,
                                                    paginator : paginator
                                                }) %>)">已读</a>
                                            </li>
                                            <li>
                                                <a class="click-link" onclick="joinPaginator(<%= JSON.stringify({
                                                    url : "message?",
                                                    cbf : "status",
                                                    cbv : 'UNREAD',
                                                    p : 1,
                                                    paginator : paginator
                                                }) %>)">未读</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-top">
                            <table class="sm-page-table ">
                                <thead>
                                <tr>
                                    <td class="goods-info"><strong>消息列表</strong></td>
                                    <td><strong>消息类型</strong></td>
                                    <td class="text-end" style="width: 150px"><strong>接受时间</strong></td>
                                </tr>
                                </thead>
                                <tbody>
                                <% var messages = data.messages || []; %>
                                <% var style = {
                                    'UNREAD':{
                                        FONT_COLOR: '#333',
                                        COLOR: 'red'
                                    },
                                    'READ':{
                                        FONT_COLOR: '#999',
                                        COLOR: '#DDD'
                                    }
                                } %>
                                <% for(var i = 0; i < messages.length; i++){ %>
                                    <tr>
                                        <td class="goods-info">
                                            <i class="fa fa-circle" style="color: <%= style[messages[i].status].COLOR %>;margin-left: 5px;font-size: 11px;top:-10px"></i>
                                            <a href="/message/read?docType=<%= messages[i].docType+'&msgId='+messages[i].id +
                                                '&docId='+messages[i].docId %>"
                                               data-status="<%=  %>" style="color: <%= style[messages[i].status].FONT_COLOR%>;font-size: 14px; ">
                                                <%= messages[i].messageBody ||　'您有一个新的'+ msgTypesName[messages[i].docType]+'，去处理[单号:'+
                                                messages[i].displayDocId+']>'%>
                                            </a>
                                        </td>
                                        <td style="color:#3A3A3A;">
                                            <%= msgTypesName[messages[i].docType] || '其他' %>
                                        </td>
                                        <td style="color:#3A3A3A;width: 150px"  class="text-end">
                                            <%= messages[i].sentTime %>
                                        </td>
                                    </tr>
                                <% } %>
                                </tbody>
                                <!--<tr>-->
                                <!--<td colspan="5" style="height: 200px">-->
                                <!--<h4 class="blank-content">您目前没有消息信息</h4>-->
                                <!--</td>-->
                                <!--</tr>-->
                            </table>
                        </div>
                    </section>
                    <% var url = "message?"%>
                    <% include ../_paginator.ejs%>
                </div>
            </div>
        </div>
        <!--Page Content Close-->
    </div>
    <% include ../_nav_bottom.ejs %>
</div><!--Off-Canvas Close-->
<% include ../footer.ejs %>